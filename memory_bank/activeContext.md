# Active Context

## Current work focus

*   Integrating the Memory Bank system into the workflow.
*   Refining data dictionary generation and access.
*   **Implementing modular data pipeline:**
    *   `1.0-mjv-data-ingestion-and-anonymization.py` (data ingestion and anonymization)
    *   `2.0-mjv-data-preparation.py` (data preparation, cleaning, and initial filtering, extracted from original `1.0-mjv-initial-data-exploration.py`)
    *   `3.0-mjv-feature-selection-and-eda.py` (feature selection and initial EDA, extracted from original `1.0-mjv-initial-data-exploration.py`)
*   Adopting a new Jupyter Notebook workflow: read `.ipynb`, edit `.py`.
*   **Feature selection and initial EDA are complete, resulting in a refined dataset for further analysis.**
*   **IV and WoE calculation code for categorical and numerical features has been refined, ensuring robust column handling, consistent naming, and rounding to 2 decimal places for IV/WoE and 4 for percentages. Detailed IV results for each feature are now saved to individual CSV files in `references/iv_details/`.**
*   **Columns have been dropped based on IV calculation and feature selection criteria.**
*   **IV interpretation and reasons in the Markdown table and `get_predictive_power` functions in the feature selection script have been updated.**
*   *   **`4.0-mjv-eda-final-features.ipynb` has been initialized, `FEATURE_CATEGORIES` populated, `plot_feature_iv` function implemented, and feature lists refined based on IV for Transaction Size and Frequency, Network Behaviors, Time-Based Behaviors, and Fund Flow Patterns. The `plot_feature_distribution` function now reads IV details from individual CSV files in `references/iv_details/`. All plots for the final selected features have been generated, and the `plot_feature_distribution` function has been refined to incorporate storytelling with data principles for enhanced clarity and impact, including parameter renaming, x-axis label re-addition, and visual adjustments to spines and labels.**

## Recent changes

*   **Refactored data pipeline into modular scripts:**
    *   `1.0-mjv-data-ingestion-and-anonymization.py` (content from `notebooks/1.0-mjv-initial-data-exploration.ipynb`)
    *   `2.0-mjv-data-preparation.py` (placeholder created)
    *   `3.0-mjv-feature-selection-and-eda.py` (content from original `notebooks/to_be_deleted/py_version/1.0-mjv-initial-data-exploration.py`)
*   **Processed data from `3.0-mjv-feature-selection-and-eda.py` is now saved as `3.0_selected_features.parquet` for subsequent analysis. Detailed IV results for individual features are saved to `references/iv_details/` as separate CSV files.**
*   **Plots generated by `2.0-mjv-data-preparation.py` and `3.0-mjv-feature-selection-and-eda.py` are now saved to `reports/figures/`.**
*   Corrected `PROJECT_ROOT` and `project_root` definitions in `bank_fraud/config.py` and `bank_fraud/utils/data_dictionary_generator.py`.
*   Adjusted `DATA_DICTIONARIES_DIR` in `bank_fraud/config.py` to point directly to `REFERENCES_DIR`.
*   Modified Jupyter Notebook print statement for `exported_path` to show relative path.
*   Created `data_dictionary_explanation.md` for Jupyter Notebook.
*   Moved `eda_checklist.md` to `notebooks/to_be_deleted/`.
*   Updated `.cursorrules` with agent persona.
*   **Created `iv_calculation.py` in `notebooks/to_be_deleted/` for categorical IV/WoE calculation.**
*   **Created `process_binning_rules.py` in `bank_fraud/utils/` and executed it to pre-process numerical binning rules.**
*   **Generated `numerical_binning_rules_processed.csv` in `references/`.**
*   **Integrating pre-processed binning rules into the feature selection script for optimized numerical IV calculation and fixed binning issues.**
*   **Refined numerical binning definitions in `bank_fraud/utils/numerical_binning_definitions.py` for improved interpretability and consistency, including:**
    *   **Consistent 5-unit ranges for time-based features (e.g., `txn_days_active_30d`, `active_days_with_txns`).**
    *   **Discrete binning (0, 1, 2+) for occurrence counts (e.g., `change_email_occurence`, `change_mob_num_occurence`).**
    *   **Revised monetary amount bins with peso signs (e.g., `amount_INSTAPAY_IN`, `total_amount_in`, `total_amount_out`, `amount_INSTAPAY_OUT`, `amt_from_source`, `amt_to_destination`).**
    *   **Adjusted count bins (e.g., `count_INSTAPAY_IN`, `count_INSTAPAY_OUT`, `count_total_in`, `count_total_out`).**
    *   **Refined ratio/percentage bins (e.g., `repeat_counterparty_ratio_in`, `repeat_counterparty_ratio_out`, `top_source_share_in`, `top_destination_share_out`).**
    *   **Updated unique entity count bins (e.g., `num_unique_source_accounts`, `num_unique_destination_accounts`, `num_unique_destination_names`).**
    *   **Revised volatility and entropy bins (e.g., `night_txn_count`, `weekend_txn_count`, `hour_entropy`, `txn_velocity_30d`, `txn_count_day_volatility_30d`).**
*   **Created `mask_iv_details.py` in `bank_fraud/utils/` for masking sensitive IV details, and added it to `.gitignore`.**
*   **Integrated `mask_iv_details.py` into `3.0-mjv-feature-selection-and-eda.py` to automatically mask sensitive categorical data in IV details CSVs after generation.**
*   **Completed the generation of all feature distribution plots in `4.0-mjv-eda-final-features.py`, and fixed an issue where bar heights were uniform and labels were missing in the `plot_feature_distribution` function.**

## Next steps

*   Analyze the generated plots from `4.0-mjv-eda-final-features.py` to synthesize key insights and fraud patterns.
*   Document the findings from the EDA.
*   Plan the subsequent steps for model training and evaluation based on the EDA insights.
*   Create a new notebook, `5.0-mjv-model-training-and-evaluation.ipynb`, to begin the modeling phase.

## Active decisions and considerations

*   Using a Markdown-based Memory Bank system for project context.
*   Ensuring consistent path management across the project.
*   Ensuring consistent application of the expert data scientist persona.
*   Using `nbconvert` for robust `.ipynb` file interaction.
*   **Reminder for IV Analysis:** Investigate 2815 `CONFIRMED_FRAUD` accounts with zero PESONET/INSTAPAY transactions during IV analysis to understand their fraud patterns.
*   **WoE and IV calculation for categorical features will use the `iv_calculation.py` script.**
*   **Numerical features will be binned using user-provided specific definitions before IV calculation.**
*   **Decision to pre-process numerical binning rules for optimization.**